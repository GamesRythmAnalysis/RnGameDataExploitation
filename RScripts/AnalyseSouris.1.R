# Analyse Souris
# Fonction pour analyse de la souris Rythmanalyse

AnalyseSouris <- function (d.M) {
  # Nombre clics (distinguer droit et gauche) / repartion en % gauche
  d.McL <- subset (d.M, M.EVENEMENT == "mouse 1 down")
  d.McR <- subset (d.M, M.EVENEMENT == "mouse 2 down")
  d.Mc <- subset (d.M, M.EVENEMENT == "mouse 1 down" | M.EVENEMENT == "mouse 2 down")
  M.NbClics <- length (d.Mc$M.TEMPS)
  M.LR <- length (d.McL$M.TEMPS)/length (d.Mc$M.TEMPS) * 100 # pourcentage clic gauche
  # Duree secondes, minutes activite souris
  M.DuS <- d.M$M.TEMPS [length(d.M$M.TEMPS)]
  M.DuM <- M.DuS / 60
  # Nombre clics par seconde
  M.NbCliclsS <- M.NbClics / M.DuS
  # Temps entre deux clics et ecart-type
  M.TpEntreAppuis <- d.Mc$M.TEMPS[2:length(d.Mc$M.TEMPS)]-d.Mc$M.TEMPS[1:length(d.Mc$M.TEMPS)-1]
  M.TpMoyEntreAppuis <- mean ( M.TpEntreAppuis)
  M.TpSDEntreAppuis <- sd (M.TpEntreAppuis)
  #M.Vit <- mean (d.M$M.VITESSE)
  if (mean (c(sd (d.M$M.XPOS),sd (d.M$M.YPOS))) > 75) { # On teste si donnees mouvement souris ne sont pas bugges
    DifX <- (d.M$M.XPOS[2:length(d.M$M.XPOS)] - d.M$M.XPOS[1:length(d.M$M.XPOS)-1])
    DifY <- d.M$M.YPOS[2:length(d.M$M.YPOS)] - d.M$M.YPOS[1:length(d.M$M.YPOS)-1]
    M.Vit <- sum (sqrt (DifX^2 +DifY^2)) / max (d.M$M.TEMPS)
  }
  else {M.Vit <- NA}
  
  #M.NbClics # Nombre total d'appuis
  #M.LR # Pourcentage de clics gauche
  #M.DuM # Duree activite souris en minutes
  #M.NbCliclsS # Clics par seconde
  #M.TpMoyEntreAppuis # Temps moyen entre deux appuis
  #M.TpSDEntreAppuis # Ecart type entre deux appuis
  #M.Vit # Moyenne des vitesses instantanÃ©es
  
  resultats <- data.frame(M.DuM,M.NbClics,M.NbCliclsS,M.LR,M.TpMoyEntreAppuis,M.TpSDEntreAppuis,M.Vit)
  return (resultats)
}