Clavier.key.analyse <- function(){
  # Nombre appuis
  d.Kdown <- subset (d.K, K.EVENEMENT == "Key Down")
  K.NbAppuis <- length (d.Kdown$K.EVENEMENT)
  
  # Duree secondes, duree minutes activite clavier
  K.DuS <- max (d.K$K.TEMPS) - min (d.K$K.TEMPS)
  K.DuM <- K.DuS / 60
  
  # Nombre d'appuis par seconde
  K.NbAppuisS <- K.NbAppuis / K.DuS
  
  # Nombre de touches utilisees
  # sort(table(d.K$K.TOUCHE), decreasing = TRUE)
  K.NbTouches <- length(levels(d.K$K.TOUCHE))
  
  # Touches frequentes
  valfreq <- 0.01
  tabletouches <- sort(table(d.Kdown$K.TOUCHE),decreasing=TRUE)
  touchesfreq <- subset (tabletouches, tabletouches > K.NbAppuis * valfreq)
  K.NbTouchesFreq <- length (touchesfreq)
  
  # Temps entre appuis et ecart-type
  K.TpEntreAppuis <- d.Kdown$K.TEMPS[2:length(d.Kdown$K.TEMPS)]-d.Kdown$K.TEMPS[1:length(d.Kdown$K.TEMPS)-1]
  K.TpMoyEntreAppuis <- mean (K.TpEntreAppuis)
  K.TpSDEntreAppuis <- sd (K.TpEntreAppuis)
  
  # Duree des appuis
  keyboard_rythm <- lapply(levels(d.K$K.TOUCHE),GetKeyRythm)
  keyboard_rythm <- do.call("rbind",keyboard_rythm)
  K.TpMoyAppui <- mean (keyboard_rythm$duration, na.rm = TRUE) # Temps moyen d'un appui
  K.TpSDAppui <- sd (keyboard_rythm$duration, na.rm = TRUE) # Ecart-type temps d'un appui
  K.TpsAppui <- sum(keyboard_rythm$duration, na.rm = TRUE) # Temps d'activite reel du clavier
  K.PropAct <- K.TpsAppui/K.DuS # % d'activite du clavier
  mostfreq <- subset (keyboard_rythm, keyboard_rythm$touche == names (touchesfreq[1])) # On ne conserve que la touche la plus frequente
  K.ToucheFreq <- mostfreq$touche[1]
  K.PropFreq <- (nrow (mostfreq)/K.NbAppuis)*100
  K.TpMoyAppuiFreq <- mean (mostfreq$duration, na.rm = TRUE) # Temps moyen d'un appui
  K.TpSDAppuiFreq <- sd (mostfreq$duration, na.rm = TRUE) # Ecart-type temps d'un appui
  
  #K.NbAppuis # Nombre total d'appuis
  #K.DuM # Duree en minute de l'activite clavier
  #K.NbAppuisS # Appuis par seconde
  #K.NbTouches # Nombre de touches utilisees
  #K.NbTouchesFreq # Nombre de touches frequemment utilisees (enlever inf. a valfreq 1%)
  #K.TpMoyEntreAppuis # Temps moyen entre appuis  
  #K.TpSDEntreAppuis # Ecart-type
  #K.TpMoyAppui # Duree moyenne d'un appui
  #K.TpSDAppui # Ecart-type duree d'un appui
  #K.TpsAppui # Temps reel d'activite du clavier
  #K.PropAct # pourcentage de temps d'activite du clavier sur la session
  #K.TpMoyAppuiFreq # Duree moyenne d'un appui sur touche la plus frequente
  #K.TpSDAppuiFreq # Ecart-type duree d'un appui sur touche la plus frequente
  
  
  
  
  resultats <- data.frame(K.DuM,K.NbTouches,K.NbTouchesFreq,
                          K.NbAppuis,K.NbAppuisS,
                          K.TpMoyEntreAppuis,K.TpSDEntreAppuis,
                          K.TpMoyAppui,K.TpSDAppui,
                          K.TpsAppui,K.PropAct,
                          K.ToucheFreq,K.PropFreq,
                          K.TpMoyAppuiFreq,K.TpSDAppuiFreq)
  return (resultats)
}