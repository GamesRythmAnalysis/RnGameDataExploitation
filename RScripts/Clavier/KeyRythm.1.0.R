
#==#==#==#==#

# Fonction click.rythm : recupere la duree des click pour un input choisi

# Return : un data frame :
# - down.time: le moment ou le l'action a commencer
# - duration: la duree de l'action
# - touche: la touche lier aux donnée

#==#==#==#==#

key.rythm <- function(key, data) {
  ## Un data frame vide pour recevoir les resultats
  results <-
    data.frame(
      "down.time" = numeric(),
      "duration" = numeric(),
      "touche" = factor()
    )
  down.time <- NULL
  
  pressList <- subset(data, K.TOUCHE == key)
  
  if (nrow(pressList) > 2) {
    
    ## On est oblige de passer par une boucle pour parser ligne par ligne
    for (i in 1:nrow(pressList)) {
      
      ## Pour la bonne cle, si l'on rencontre un down, le stocker
      ##(ainsi, si l'on rencontre deux down de suite, sans up entre les deux,
      ##le premier sera effaee et seul le second comptera)
      if (pressList$K.EVENEMENT[i] == "Key Down") {
        down.time <- pressList$K.TEMPS[i]
      }  else {
        
        ## verifier si l'on a bien eu un down precedemment
        if (is.null(down.time)) {
          duration <- NA
          down.time <- NA
          
        } else{
          
          ## Calculer la duree entre down et up
          duration <- pressList$K.TEMPS[i] - down.time
          
        }
        
        ligne <- c(down.time, duration)
        results <- rbind (results, ligne)
        
        ## vider le down (en cas de deux up consecutifs, au cas ou)
        down.time <- NULL
      }
      
    }
    
    ## ajouter une variable identifiant la cle pour fusion avec les resultats sur les autres cle
    results$touche <- key
  }
  names (results) <- c ("down.time", "duration", "touche")
  return(results)
}
