# SORTIES GRAPHIQUES
# GRAPHIQUES PAD

graphiques.pad.touches <- function (timingappui,P.NbTouchesFreq, P.DuM, rez, infobaz) {
  
  graphiques.density(timingappui,P.TEMPS,"black",
                     paste (infobaz,"\n","Densite des appuis pad"),"",
                     paste (infobaz,".P10.2",".png", sep =""),
                     "Temps (s)","Appuis")
  
  ggplot(timingappui, aes (P.TEMPS))+
    geom_density(adjust = 0.08) +
    xlab ("Temps (s)") +
    ylab ("Appuis") +
    ggtitle (paste (infobaz,"\n","Densite des appuis pad"))+
    theme_classic()
  ggsave(filename = paste (infobaz,".P10",".png", sep =""), width = 15, height = 7)
  
  # Decomposition densite par touches (sur touches freq.)
  # Pas plus de 9 touches freq. pour plage couleur
  tchfreq <- sort (table (timingappui$P.TOUCHE), decreasing = TRUE)
  ifelse (P.NbTouchesFreq < 10, 
          nomtchfreq <- rownames (tchfreq)[1:P.NbTouchesFreq],
          nomtchfreq <- rownames (tchfreq)[1:9])
  timingappui2 <- subset(timingappui, P.TOUCHE %in% nomtchfreq)
  
  graphiques.stack(timingappui2,P.TEMPS,P.TOUCHE,P.DuM*3,
                   "Frequence des appuis pad (touches frequentes) | binwidth variable",
                   infobaz,"Touche",paste (infobaz,".TCHVAR",".png", sep =""),
                   "Temps (s)","Appuis")

  viztouches <- rez %>%
    filter (P.TOUCHE %in% nomtchfreq)
  
  graphiques.treemap(viztouches,P.NbAppuis,P.TOUCHE,P.TOUCHE,
                     "Frequence des appuis pad (touches frequentes)",
                     infobaz,paste (infobaz,".TCHFREQ",".png", sep =""))
  
  graphiques.treemap(viztouches,P.TpMoyAppui,P.TOUCHE,P.TOUCHE,
                     "Duree moyenne des appuis pad (touches frequentes)",
                     infobaz,paste (infobaz,".TCHDUR",".png", sep =""))
  
  graphiques.treemap(viztouches,P.DurAppuiTot,P.TOUCHE,P.TOUCHE,
                     "Duree totale des appuis pad (touches frequentes)",
                     infobaz,paste (infobaz,".TCHDURTOT",".png", sep =""))
  
}
  
  
plotStick <- function (stickData,title,save.file){
    normaliser <- function (XY) { # fonction pour eliminer deadzone du plot stick
      (XY-min(XY))/diff(range(XY))  
    }
    
    d <- stickData
    ifelse (nrow(d)>10000,
            d2sampl <- d[sample(nrow(d), (nrow(d)/10)), ],
            d2sampl<-d)
    d2sampl[is.na(d2sampl)] <- 0
    d2sampl[d2sampl$X>0,]$X <- normaliser (d2sampl[d2sampl$X>0,]$X)
    d2sampl[d2sampl$X<0,]$X <- - normaliser(abs(d2sampl[d2sampl$X<0,]$X))
    d2sampl[d2sampl$Y>0,]$Y <- normaliser (d2sampl[d2sampl$Y>0,]$Y)
    d2sampl[d2sampl$Y<0,]$Y <- - normaliser (abs(d2sampl[d2sampl$Y<0,]$Y)) 
    
    return(graphiques.heatmap(d2sampl,-X,-Y,title,save.file))
    
}
  
plotdpad <- function (dpad, infobaz) {
    dpad2 <- subset (dpad, dpad$P.VALEUR != 0)
    ggplot (dpad2, aes (P.VALEUR)) + 
      geom_bar()+
      coord_polar (theta ="x", start = 5.09)+
      ggtitle (paste (infobaz,"\n","Usage Dpad"))+
      xlab ("")+
      ylab ("")+
      scale_y_discrete(breaks=NULL)+
      theme_classic()
    ggsave(filename = paste (infobaz,".Dpad",".png", sep =""), width = 7, height = 7)
}
