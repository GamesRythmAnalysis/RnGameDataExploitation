# SORTIES GRAPHIQUES
# GRAPHIQUES PAD

graphiques.pad.touches <- function (timingappui,P.NbTouchesFreq, P.DuM, rez, infobaz) {

ggplot(timingappui, aes (P.TEMPS))+
  geom_density(adjust = 0.08) +
  xlab ("Temps (s)") +
  ylab ("Appuis") +
  ggtitle (paste (infobaz,"\n","Densite des appuis pad"))+
  theme_classic()
ggsave(filename = paste (infobaz,".P10",".png", sep =""), width = 15, height = 7)

# Decomposition densite par touches (sur touches freq.)
# Pas plus de 9 touches freq. pour plage couleur
tchfreq <- sort (table (timingappui$P.TOUCHE), decreasing = TRUE)
ifelse (P.NbTouchesFreq < 10, 
        nomtchfreq <- rownames (tchfreq)[1:P.NbTouchesFreq],
        nomtchfreq <- rownames (tchfreq)[1:9])
timingappui2 <- subset(timingappui, P.TOUCHE %in% nomtchfreq)

ggplot(timingappui2, aes (P.TEMPS, fill = P.TOUCHE))+
  geom_area(stat="bin", binwidth = P.DuM*3, position = "stack", linetype = 1, size = 0.8, colour ="black") +
  xlab ("Temps (s)") +
  ylab ("Appuis") +
  ggtitle (label = "Frequence des appuis pad (touches frequentes) | binwidth variable",
           subtitle = infobaz) +
  scale_fill_brewer("Touche", palette="Set1")+
  theme_classic()
ggsave(filename = paste (infobaz,".TCHVAR",".png", sep =""), width = 15, height = 7)

viztouches <- rez %>%
  filter (P.TOUCHE %in% nomtchfreq)

ggplot (data = viztouches, aes (area = P.NbAppuis, fill = P.TOUCHE, label = P.TOUCHE))+
  geom_treemap(linetype = 1, colour ="white", size =3) +
  scale_fill_brewer(palette = "Set1") +
  ggtitle (label = "Frequence des appuis pad (touches frequentes)",
           subtitle = infobaz) +
  theme(plot.title = element_text(size = 20, face = "bold", hjust = 0)) +
  geom_treemap_text(grow = TRUE, reflow = TRUE) +
  guides (fill = FALSE)
ggsave(filename = paste (infobaz,".TCHFREQ",".png", sep =""), width = 15, height = 15)

ggplot (data = viztouches, aes (area = P.TpMoyAppui, fill = P.TOUCHE, label = P.TOUCHE))+
  geom_treemap(linetype = 1, colour ="white", size =3) +
  scale_fill_brewer(palette = "Set1") +
  ggtitle (label = "Duree moyenne des appuis pad (touches frequentes)",
           subtitle = infobaz) +
  theme(plot.title = element_text(size = 20, face = "bold", hjust = 0)) +
  geom_treemap_text(grow = TRUE, reflow = TRUE) +
  guides (fill = FALSE)
ggsave(filename = paste (infobaz,".TCHDUR",".png", sep =""), width = 15, height = 15)

ggplot (data = viztouches, aes (area = P.DurAppuiTot, fill = P.TOUCHE, label = P.TOUCHE))+
  geom_treemap(linetype = 1, colour ="white", size =3) +
  scale_fill_brewer(palette = "Set1") +
  ggtitle (label = "Duree totale des appuis pad (touches frequentes)",
           subtitle = infobaz) +
  theme(plot.title = element_text(size = 20, face = "bold", hjust = 0)) +
  geom_treemap_text(grow = TRUE, reflow = TRUE) +
  guides (fill = FALSE)
ggsave(filename = paste (infobaz,".TCHDURTOT",".png", sep =""), width = 15, height = 15)

}


plotStick <- function (stickData){
  normaliser <- function (XY) { # fonction pour eliminer deadzone du plot stick
    (XY-min(XY))/diff(range(XY))  
  }
  
  d <- stickData
  ifelse (nrow(d)>10000,
          d2sampl <- d[sample(nrow(d), (nrow(d)/10)), ],
          d2sampl<-d)
  d2sampl[is.na(d2sampl)] <- 0
  d2sampl[d2sampl$X>0,]$X <- normaliser (d2sampl[d2sampl$X>0,]$X)
  d2sampl[d2sampl$X<0,]$X <- - normaliser(abs(d2sampl[d2sampl$X<0,]$X))
  d2sampl[d2sampl$Y>0,]$Y <- normaliser (d2sampl[d2sampl$Y>0,]$Y)
  d2sampl[d2sampl$Y<0,]$Y <- - normaliser (abs(d2sampl[d2sampl$Y<0,]$Y))  
  ggplot (d2sampl,aes (x=-X, y=-Y)) +
    geom_point(colour ="lightblue", alpha =0.25) +
    stat_density2d(aes(alpha = ..level.., fill=..level..), bins = 15, geom = "polygon")+
    scale_alpha_continuous(guide = FALSE)+
    scale_fill_gradient(low = "green", high = "red") +
    geom_density2d (colour="black", bins = 15, alpha = 0.25)  
}

plotdpad <- function (dpad, infobaz) {
  dpad2 <- subset (dpad, dpad$P.VALEUR != 0)
  ggplot (dpad2, aes (P.VALEUR)) + 
    geom_bar()+
    coord_polar (theta ="x", start = 5.09)+
    ggtitle (paste (infobaz,"\n","Usage Dpad"))+
    xlab ("")+
    ylab ("")+
    scale_y_discrete(breaks=NULL)+
    theme_classic()
  ggsave(filename = paste (infobaz,".Dpad",".png", sep =""), width = 7, height = 7)
}
